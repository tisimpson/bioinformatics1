"0","#load limma a package for calling differntially expressed genes"
"0","library(limma);"
"0","#load the Bioconductor annotation file for the Drosophila_2 chips"
"0","library(drosophila2.db);"
"2","Loading required package: org.Dm.eg.db
"
"2","
"
"2","
"
"0","#convert the expresison matrix from log2 scale to base 10"
"0","exprs <- data.frame(2^exprs); # we're just extracting the expression slot from the ExpressionSet object, convert to base10"
"0",""
"0","#add group to the annotation data"
"0","d <- data.frame(pData(data));"
"0","d$group<-interaction(d$gfp,d$sample,sep='');"
"0",""
"0","#rename columns to make easier to identify"
"0","colnames(exprs) <- d$group[match(row.names(d),colnames(exprs))];"
"0",""
"0","#these variables can be exported to the environment so that they can be referred to directly"
"0","attach(exprs);"
"0",""
"0","#create an enrichment matrix by dividing GFP+ signal by GFP- signal"
"0","enrich <- data.frame(s1=p1/n1,s2=p2/n2,s3=p3/n3,s4=p4/n4,s5=p5/n5,s6=p6/n6,s7=p7/n7,s8=p8/n8,row.names=row.names(exprs));"
"0",""
"0","#set up the 'levels' matrix (this shows the groupings for contrasts)"
"0","enrich_design <- table(data.frame(row.names=colnames(enrich),unique(d[,1:2])));"
"0","#look at it"
"0","enrich_design;"
"1","      condition
"
"1","sample"
"1"," mut"
"1"," wt"
"1","
     1"
"1","   0"
"1","  1"
"1","
     2"
"1","   0"
"1","  1"
"1","
     3"
"1","   0"
"1","  1"
"1","
     4"
"1","   0"
"1","  1"
"1","
     5"
"1","   1"
"1","  0"
"1","
     6"
"1","   1"
"1","  0"
"1","
     7"
"1","   1"
"1","  0"
"1","
     8"
"1","   1"
"1","  0"
"1","
"
"0","#set up the contrast matrix (what we are comparing) - note 'wt-mut'"
"0","cont.matrix <- makeContrasts(wt-mut,levels=enrich_design);"
"0","#look at it"
"0","cont.matrix;"
"1","      Contrasts
"
"1","Levels"
"1"," wt - mut"
"1","
   mut"
"1","       -1"
"1","
   wt "
"1","        1"
"1","
"
"0","#fit the linear model"
"0","fit <- lmFit(enrich, enrich_design);"
"0",""
"0","#calculate the fit coefficients and error for the comparison(s)"
"0","fit2 <- contrasts.fit(fit, cont.matrix);"
"0",""
"0","#calculate t-statistics and log-odds of differential expression using emperical Bayes approach"
"0","fit2 <- eBayes(fit2);"
"0",""
"0","#have a quick look at the result"
"0","topTable(fit2,n=10,sort.by='logFC',p=0.01,adjust='fdr');"
